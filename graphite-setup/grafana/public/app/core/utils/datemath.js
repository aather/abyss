/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["require","exports","lodash","moment"],function(a,b,c,d){function e(a,b){if(!a)return void 0;if(d.isMoment(a))return a;if(c.isDate(a))return d(a);var e,f,h,i="";return"now"===a.substring(0,3)?(e=d(),i=a.substring("now".length)):(f=a.indexOf("||"),-1===f?(h=a,i=""):(h=a.substring(0,f),i=a.substring(f+2)),e=d(h)),i.length?g(i,e,b):e}function f(a){var b=e(a);return b&&d.isMoment(b)?b.isValid():!1}function g(a,b,d){for(var e=b,f=0,g=a.length;g>f;){var i,j,k,l=a.charAt(f++);if("/"===l)i=0;else if("+"===l)i=1;else{if("-"!==l)return void 0;i=2}if(isNaN(a.charAt(f)))j=1;else if(2===a.length)j=a.charAt(f);else{for(var m=f;!isNaN(a.charAt(f));)if(f++,f>10)return void 0;j=parseInt(a.substring(m,f),10)}if(0===i&&1!==j)return void 0;if(k=a.charAt(f++),!c.contains(h,k))return void 0;0===i?d?e.endOf(k):e.startOf(k):1===i?e.add(j,k):2===i&&e.subtract(j,k)}return e}{var h=["y","M","w","d","h","m","s"],i=c.sortBy(h,function(a){return d.duration(1,a).valueOf()});i.reverse()}return{parse:e,parseDateMath:g,isValid:f}});