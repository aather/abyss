/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["angular","app/app","lodash","require","app/components/panelmeta"],function(a,b,c,d,e){"use strict";var f,g=a.module("grafana.panels.text",[]);b.useModule(g),g.directive("grafanaPanelText",function(){return{controller:"TextPanelCtrl",templateUrl:"app/panels/text/module.html"}}),g.controller("TextPanelCtrl",["$scope","templateSrv","$sce","panelSrv",function(a,b,g,h){a.panelMeta=new e({panelName:"Text",editIcon:"fa fa-text-width",fullscreen:!0}),a.panelMeta.addEditorTab("Edit text","app/panels/text/editor.html");var i={title:"default title",mode:"markdown",content:"",style:{}};c.defaults(a.panel,i),a.init=function(){h.init(a),a.ready=!1,a.render()},a.refreshData=function(){a.panelMeta.loading=!1,a.render()},a.render=function(){"markdown"===a.panel.mode?a.renderMarkdown(a.panel.content):"html"===a.panel.mode?a.updateContent(a.panel.content):"text"===a.panel.mode&&a.renderText(a.panel.content),a.panelRenderingComplete()},a.renderText=function(b){b=b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\n/g,"<br/>"),a.updateContent(b)},a.renderMarkdown=function(b){var c=b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;");f?a.updateContent(f.makeHtml(c)):d(["./lib/showdown"],function(b){f=new b.converter,a.updateContent(f.makeHtml(c))})},a.updateContent=function(c){try{a.content=g.trustAsHtml(b.replace(c,a.panel.scopedVars))}catch(d){console.log("Text panel error: ",d),a.content=g.trustAsHtml(c)}a.$$phase||a.$digest()},a.openEditor=function(){},a.init()}])});