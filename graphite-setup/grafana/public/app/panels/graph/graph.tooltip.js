/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["jquery"],function(a){"use strict";function b(b,c,d,e){var f=this,g=a('<div id="tooltip">');this.findHoverIndexFromDataPoints=function(a,b,c){for(var d=b.datapoints.pointsize,e=c*d,f=b.datapoints.points.length,g=e;f>g;g+=d)if(b.datapoints.points[g]>a)return Math.max(g-d,0)/d;return g/d-1},this.findHoverIndexFromData=function(a,b){for(var c=b.data.length,d=0;c>d;d++)if(b.data[d][0]>a)return Math.max(d-1,0);return d-1},this.showTooltip=function(a,b,c){var d='<div class="graph-tooltip small"><div class="graph-tooltip-time">'+a+"</div> ";d+=b+"</div>",g.html(d).place_tt(c.pageX+20,c.pageY)},this.getMultiSeriesPlotHoverInfo=function(a,b){var c,e,f,g,h=[],i=0;for(e=0;e<a.length;e++)if(f=a[e],!f.data.length||d.panel.legend.hideEmpty&&f.allIsNull)h.push({hidden:!0});else if(g=this.findHoverIndexFromData(b.x,f),h.time=f.data[g][0],f.stack?"individual"===d.panel.tooltip.value_type?c=f.data[g][1]:f.stack?(i+=f.data[g][1],c=i):c=f.data[g][1]:c=f.data[g][1],f.lines.steps||f.stack){var j=this.findHoverIndexFromDataPoints(b.x,f,g);h.push({value:c,hoverIndex:j})}else h.push({value:c,hoverIndex:g});return h},b.mouseleave(function(){if(d.panel.tooltip.shared){var a=b.data().plot;a&&(g.detach(),a.unhighlight())}c.sharedCrosshair&&d.appEvent("clearCrosshair")}),b.bind("plothover",function(a,h,i){var j,k,l,m,n,o,p,q=b.data().plot,r=q.getData(),s=e();if(c.sharedCrosshair&&d.appEvent("setCrosshair",{pos:h,scope:d}),0!==s.length)if(d.panel.tooltip.shared){q.unhighlight();var t=f.getMultiSeriesPlotHoverInfo(r,h);for(p="",l=c.formatDate(t.time),n=0;n<t.length;n++)m=t[n],m.hidden||(o=s[n],k=o.formatValue(m.value),p+='<div class="graph-tooltip-list-item"><div class="graph-tooltip-series-name">',p+='<i class="fa fa-minus" style="color:'+o.color+';"></i> '+o.label+":</div>",p+='<div class="graph-tooltip-value">'+k+"</div></div>",q.highlight(n,m.hoverIndex));f.showTooltip(l,p,h)}else i?(o=s[i.seriesIndex],j='<div class="graph-tooltip-list-item"><div class="graph-tooltip-series-name">',j+='<i class="fa fa-minus" style="color:'+i.series.color+';"></i> '+o.label+":</div>",k=d.panel.stack&&"individual"===d.panel.tooltip.value_type?i.datapoint[1]-i.datapoint[2]:i.datapoint[1],k=o.formatValue(k),l=c.formatDate(i.datapoint[0]),j+='<div class="graph-tooltip-value">'+k+"</div>",f.showTooltip(l,j,h)):g.detach()})}return b});