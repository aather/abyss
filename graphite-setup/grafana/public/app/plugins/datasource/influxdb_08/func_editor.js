/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["angular","lodash","jquery"],function(a,b,c){"use strict";a.module("grafana.directives").directive("influxdbFuncEditor08",["$compile",function(a){var d='<a gf-dropdown="functionMenu" class="dropdown-toggle" data-toggle="dropdown">{{target.function}}</a><span>(</span>',e='<input type="text" style="display:none" class="input-mini tight-form-func-param"></input>';return{restrict:"A",link:function(f,g){function h(){var a=c(this),b=a.next();b.val(f.target.column),b.css("width",a.width()+16+"px"),a.hide(),b.show(),b.focus(),b.select();var d=b.data("typeahead");d&&(b.val(""),d.lookup())}function i(){var a=c(this),b=a.prev();""!==a.val()&&(b.text(a.val()),f.target.column=a.val(),f.$apply(f.get_data)),a.hide(),b.show()}function j(a){13===a.which&&i.call(this)}function k(){this.style.width=8*(3+this.value.length)+"px"}function l(a){a.attr("data-provide","typeahead"),a.typeahead({source:function(){return f.listColumns.apply(null,arguments)},minLength:0,items:20,updater:function(b){return setTimeout(function(){i.call(a[0])},0),b}});var b=a.data("typeahead");b.lookup=function(){var a;return this.query=this.$element.val()||"",a=this.source(this.query,c.proxy(this.process,this)),a?this.process(a):a}}function m(){n.appendTo(g);var b=c('<a ng-click="" class="graphite-func-param-link">'+f.target.column+"</a>"),d=c(e);b.appendTo(g),d.appendTo(g),d.blur(i),d.keyup(k),d.keypress(j),b.click(h),l(d),c("<span>)</span>").appendTo(g),a(g.contents())(f)}var n=c(d);f.functionMenu=b.map(f.functions,function(a){return{text:a,click:"changeFunction('"+a+"');"}}),m()}}}])});