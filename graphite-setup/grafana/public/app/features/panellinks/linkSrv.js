/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["angular","kbn","lodash"],function(a,b,c){"use strict";a.module("grafana.services").service("linkSrv",["templateSrv","timeSrv",function(a,d){this.getLinkUrl=function(b){var c=a.replace(b.url||""),e={};if(b.keepTime){var f=d.timeRangeForUrl();e.from=f.from,e.to=f.to}return b.includeVars&&a.fillVariableValuesForUrl(e),this.addParamsToUrl(c,e)},this.addParamsToUrl=function(a,b){var d=[];return c.each(b,function(a,b){null!==a&&(a===!0?d.push(b):c.isArray(a)?c.each(a,function(a){d.push(b+"="+encodeURIComponent(a))}):d.push(b+"="+encodeURIComponent(a)))}),0===d.length?a:this.appendToQueryString(a,d.join("&"))},this.appendToQueryString=function(a,b){if(!c.isUndefined(b)&&null!==b&&""!==b){var d=a.indexOf("?");-1!==d?a.length-d>1&&(a+="&"):a+="?",a+=b}return a},this.getAnchorInfo=function(b){var c={};return c.href=this.getLinkUrl(b),c.title=a.replace(b.title||""),c},this.getPanelLinkAnchorInfo=function(c,e){var f={};if("absolute"===c.type)f.target=c.targetBlank?"_blank":"_self",f.href=a.replace(c.url||"",e),f.title=a.replace(c.title||"",e);else if(c.dashUri)f.href="dashboard/"+c.dashUri+"?",f.title=a.replace(c.title||"",e),f.target=c.targetBlank?"_blank":"";else{f.title=a.replace(c.title||"",e);var g=b.slugifyForUrl(c.dashboard||"");f.href="dashboard/db/"+g+"?"}var h={};if(c.keepTime){var i=d.timeRangeForUrl();h.from=i.from,h.to=i.to}return c.includeVars&&a.fillVariableValuesForUrl(h,e),f.href=this.addParamsToUrl(f.href,h),c.params&&(f.href=this.appendToQueryString(f.href,a.replace(c.params,e))),f}}])});