/*! grafana - v2.5.0 - 2015-10-28
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["angular","jquery","config"],function(a,b,c){"use strict";var d=a.module("grafana.directives");d.directive("panelLoader",["$compile","$parse",function(b,d){return{restrict:"E",link:function(e,f,g){var h=d(g.type),i=h(e),j=c.panels[i].path;e.require([j+"/module"],function(){var c=a.element(document.createElement("grafana-panel-"+i));f.append(c),b(c)(e)})}}}]),d.directive("grafanaPanel",function(){return{restrict:"E",templateUrl:"app/features/panel/partials/panel.html",transclude:!0,link:function(a,b){var c=b.find(".panel-container");a.$watchGroup(["fullscreen","height","panel.height","row.height"],function(){c.css({minHeight:a.height||a.panel.height||a.row.height,display:"block"}),b.toggleClass("panel-fullscreen",a.fullscreen?!0:!1)})}}}),d.service("dynamicDirectiveSrv",["$compile","$parse","datasourceSrv",function(b,c,d){var e=this;this.addDirective=function(c,d,e){var f=a.element(document.createElement(c.name+"-"+d));c.parentElem.append(f),b(f)(e)},this.define=function(a){var b;a.scope.$watch(a.datasourceProperty,function(c){b&&(b.$destroy(),a.parentElem.empty()),b=a.scope.$new(),d.get(c).then(function(c){e.addDirective(a,c.meta.type,b)})})}}]),d.directive("queryEditorLoader",["$compile","$parse","datasourceSrv",function(b,c,d){return{restrict:"E",link:function(c,e){var f;c.$watch("panel.datasource",function(){var g=c.target.datasource||c.panel.datasource;d.get(g).then(function(d){f&&(f.$destroy(),e.empty()),f=c.$new(),f.datasource=d,c.target.refId||(c.target.refId="A");var g=a.element(document.createElement("metric-query-editor-"+d.meta.type));e.append(g),b(g)(f)})})}}}]),d.directive("datasourceEditorView",["dynamicDirectiveSrv",function(a){return{restrict:"E",link:function(b,c,d){a.define({datasourceProperty:d.datasource,name:d.name,scope:b,parentElem:c})}}}]),d.directive("panelResizer",["$rootScope",function(a){return{restrict:"E",template:'<span class="resize-panel-handle"></span>',link:function(c,d){function e(a){a.preventDefault(),l=!0,h=b(a.target).offset(),i=parseInt(c.row.height),j=c.panel.span,k=b(document).width(),m=c.row.panels[c.row.panels.length-1],b("body").on("mousemove",f),b("body").on("mouseup",g)}function f(a){c.row.height=i+(a.pageY-h.top),c.panel.span=j+(a.pageX-h.left)/k*12,c.panel.span=Math.min(Math.max(c.panel.span,1),12);var b=c.dashboard.rowSpan(c.row);Math.floor(b)<14&&(m===c.panel&&b>12?m.span-=b-12:m!==c.panel&&(m.span=m.span-(b-12),m.span=Math.min(Math.max(m.span,1),12))),c.$apply(function(){c.$broadcast("render")})}function g(){var d=c.dashboard.rowSpan(c.row);12>d&&d>11&&(m.span+=12-d),c.$apply(function(){a.$broadcast("render")}),b("body").off("mousemove",f),b("body").off("mouseup",g)}var h,i,j,k,l=!1,m=!1;d.on("mousedown",e),c.$on("$destroy",function(){d.off("mousedown",e)})}}}])});